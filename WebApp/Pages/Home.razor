@page "/"
@using System.Runtime.InteropServices
@using Miniproject1.Components
@inject NavigationManager NavManager
@inject ILoginService LoginService

<h1>Explore all our Posts!</h1>

<OrderDisplay />

<button @onclick="HandleLoginLogoutClick" class="btn btn-primary mt-3">
    @buttonText
</button>

@code {
private string buttonText = "Log In";

protected override async Task OnInitializedAsync()
{
// Tjek om brugeren er logget ind, og opdater knapteksten
try
{
    var user = await LoginService.GetUserLoggedIn();
    buttonText = user == null ? "Log In" : "Log Out";
}
catch (Exception ex)
{
    Console.WriteLine($"Error during initialization: {ex.Message}");
}
}

private async Task HandleLoginLogoutClick()
{
var user = await LoginService.GetUserLoggedIn();

if (user == null)
{
// Hvis brugeren ikke er logget ind, naviger til login-siden
NavManager.NavigateTo("/login/Home");
}
else
{
// Hvis brugeren er logget ind, log dem ud og opdater knapteksten
try
{
    await LoginService.Logout();
    buttonText = "Log In";
    await InvokeAsync(StateHasChanged); // Opdaterer UI
}
catch (Exception ex)
{
    Console.WriteLine($"Error during logout: {ex.Message}");
}


